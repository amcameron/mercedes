#! /usr/bin/env node

var stdio = require('stdio');
var ops = stdio.getopt({
	'path': {
		key: 'p',
		args: 1,
		description: 'Scanning Path Root',
		mandatory: true
	},
	'out_path': {
		key: 'o',
		args: 1,
		description: 'Output Path'
	},
	'verbose': {
		key: 'v',
		args: 0,
		description: 'verbose'
	},
	'default_lang': {
		key: 'd',
		args: 1,
		description: 'default language'
	},
	'spa_enc': {
		key: 'e',
		args: 1,
		description: 'spanish language encoding'
	}
});

ops.default_lang = ops.default_lang || 'spa';
ops.spa_enc = ops.spa_enc || 'windows-1252';

var pjson = require('../package.json');
console.log('vtools-cli ' + pjson.version);

var walk = require('walk'),
	fs = require('fs'),
	options, walker;

var path = require('path');
var mkvmodule = require('../lib/mkvmerge.js')(ops);

var cmdlineArray = [];

options = {
	followLinks: false,
	// directories with these keys will be skipped
	filters: ["ready", "_Temp"],
	listeners: {
		file: function (root, fileStats, next) {
			mkvmodule.merge(root, fileStats);
			next();
    },
		end: function () {
			console.log("all done");
		}
	}
};

walker = walk.walk(ops.path, options);

